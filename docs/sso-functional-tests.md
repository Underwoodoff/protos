# Функциональное тестирование SSO

В проекте SSO реализована система функционального тестирования, которая позволяет проверять работу сервиса аутентификации в условиях, максимально приближенных к реальным. Такие тесты рассматривают приложение как "черный ящик", что позволяет проверить весь процесс аутентификации и авторизации без знания внутренней реализации.

## Особенности функционального тестирования

Функциональные тесты в SSO играют важную роль не только для проверки корректности работы системы, но и как инструмент для отладки сложных сценариев аутентификации. Они особенно полезны при разработке новых функций безопасности и оптимизации процессов авторизации. Тесты позволяют моделировать различные сценарии использования сервиса, включая обработку ошибок и граничные случаи.

## Архитектура тестов

В проекте SSO тесты организованы в отдельной директории `tests/`, что обеспечивает четкое разделение тестового кода от основного. Структура тестового окружения выглядит следующим образом:

```
./tests
├── auth_register_login_test.go ... Тесты регистрации и аутентификации
├── admin_operations_test.go ....... Тесты операций администратора
├── migrations .................... Миграции для тестовой базы данных
│   └── 1_init_apps.up.sql
└── suite
    └── suite.go .................. Подготовка тестового окружения
```

В директории `tests/migrations` хранятся SQL-скрипты для инициализации тестовой базы данных. Они содержат минимально необходимые данные для работы тестов, такие как предустановленные приложения и административные учетные записи. Директория `tests/suite` содержит код для подготовки тестового окружения, включая настройку подключения к базе данных и создание gRPC-клиента.

## Генерация тестовых данных

Для создания тестовых данных в SSO используется библиотека `brianvoe/gofakeit`. Она позволяет генерировать реалистичные данные для тестирования различных сценариев аутентификации. Например, для создания тестовых учетных записей используются следующие функции:

```go
const passDefaultLen = 10

email := gofakeit.Email()
pass := gofakeit.Password(true, true, true, true, false, passDefaultLen)
```

Для улучшения читаемости кода и упрощения использования, генерация паролей обернута в отдельную функцию:

```go
func randomFakePassword() string {
    return gofakeit.Password(true, true, true, true, false, passDefaultLen)
}
```

## Преимущества подхода

Функциональное тестирование в SSO предоставляет несколько ключевых преимуществ. Во-первых, оно позволяет проверить весь процесс аутентификации от начала до конца, включая взаимодействие с базой данных и генерацию токенов. Во-вторых, тесты можно легко запускать локально, что ускоряет процесс разработки и отладки.

Еще одним важным преимуществом является возможность тестирования различных сценариев безопасности. Тесты позволяют проверить обработку некорректных учетных данных, попытки несанкционированного доступа и другие аспекты безопасности системы. Кроме того, в процессе написания тестов создается надежный gRPC-клиент, который можно использовать для дальнейших экспериментов и тестирования различных параметров системы.

## Изоляция тестового окружения

В SSO тесты выполняются в изолированной среде, где все внешние зависимости заменяются моками. Это позволяет тестировать систему независимо от других сервисов и обеспечивает воспроизводимость результатов тестирования. Такая изоляция особенно важна для тестирования безопасности, так как позволяет моделировать различные атаки и проверять защитные механизмы системы без риска для реальных данных. 