# Взаимодействие SSO и URL Shortener

## Архитектурное описание

Система построена на основе микросервисной архитектуры, где SSO (Single Sign-On) и URL Shortener являются отдельными сервисами, взаимодействующими между собой через gRPC. Клиентская часть взаимодействует с URL Shortener через HTTP REST API.

## Компоненты системы

### URL Shortener
Сервис состоит из трех основных компонентов:
1. HTTP Server - обрабатывает входящие REST запросы
2. Auth Middleware - проверяет авторизацию и права доступа
3. URL Service - реализует бизнес-логику работы с URL

### SSO Service
Сервис аутентификации включает:
1. Auth Service - обрабатывает запросы на проверку прав
2. SQLite Storage - хранит данные пользователей и их права

## Процесс взаимодействия

### 1. Инициация запроса
Клиент отправляет HTTP POST запрос на эндпоинт `/api/urls` с JWT токеном в заголовке Authorization. Токен содержит информацию о пользователе и его правах.

### 2. Проверка авторизации
HTTP Server URL Shortener передает запрос в Auth Middleware, который:
- Проверяет наличие токена
- Валидирует JWT токен
- Извлекает userID из токена

### 3. Проверка прав доступа
Auth Middleware отправляет gRPC запрос к SSO Service:
- Использует метод IsAdmin()
- Передает userID
- Применяет интерцепторы для логирования и повторных попыток

### 4. Проверка в базе данных
SSO Service проверяет права пользователя в SQLite:
- Выполняет запрос к таблице users
- Проверяет поле is_admin
- Возвращает результат проверки

### 5. Обработка результата
Auth Middleware на основе полученного результата:
- Принимает решение о доступе
- Добавляет информацию о пользователе в контекст запроса
- Передает управление в URL Service

### 6. Завершение запроса
URL Service:
- Обрабатывает URL
- Сохраняет результат
- Возвращает ответ клиенту

## Особенности реализации

### Безопасность
- Использование JWT токенов для аутентификации
- Проверка прав через отдельный сервис
- Изоляция сервисов

### Надежность
- Интерцепторы для логирования и повторных попыток
- Обработка ошибок на каждом этапе
- Сохранение консистентности данных

### Масштабируемость
- Независимость сервисов
- Возможность горизонтального масштабирования
- Легкость добавления новых компонентов 